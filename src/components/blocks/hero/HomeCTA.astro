---

import Section from '../../ui/Section.astro'
import Row from '../../ui/Row.astro'
import Col from '../../ui/Col.astro'

import Button from '../../ui/Button.astro'
import { Image } from 'astro:assets'


import heroImage from '../../../assets/hero-01.png'
---
<Section id="intro" padding="none" classes="bg-neutral-50 dark:bg-neutral-900">
    <Row>
        <Col span="2" />
        <Col span="8" align="center">
            <br><br><h1>Descubre el <strong>significado</strong>  de tus <strong>sueños</strong></h1>
            
            <p class="pb-0 text-lg"> Descifra los mensajes ocultos de tus sueños y profundiza en tu autoconocimiento.</p>
            <Button size="lg" link="/login">Empieza ahora</Button><br><br>
        </Col>
        <Col span="2" />
    </Row>
</Section>

<Section id="hero-image" padding="none" classes="bg-neutral-50 dark:bg-neutral-900">
    <Row>
        <Col span="2" />
        <Col span="8" align="center">
            <Image
                src={heroImage}
                alt="AI-powered dream analyzer tool"
                class="max-w-full h-auto"
                format="webp"
            />
        </Col>
        <Col span="2" />
    </Row>
</Section>

<Section id="dream-form" padding="none" classes="bg-neutral-50 dark:bg-neutral-900">
    <Row>
        <Col span="2" />
        <Col span="8" align="center">
            <h3 class="text-3xl font-semibold mb-4">Recibe una Interpretación Instantánea con nuestro <strong>Fast-AI Dream Analyzer</strong>.</h3>
            
            <p class="text-sm text-gray-500 dark:text-gray-300 mb-4">
                Por favor, usa esta herramienta de manera responsable. Los resultados están destinados solo para orientación general. <strong><a href="/faq" style="color: #7BC7C7; text-decoration: none;">Más Información.</a></strong>
            </p>            
            <form id="dreamForm" class="space-y-4">
                <textarea id="dreamDescription" name="dreamDescription" style="background:transparent; border-radius:10px;" rows="4" cols="50" minlength="30" required class="w-full p-2 border border-gray-300 rounded" placeholder="Ingresa una descripción detallada de tu sueño..."></textarea>
                <label id="comprehensiveAnalysisLabel" for="dreamDescription" class="block text-lg font-medium mb-2 hidden">
                    Para un análisis más completo, prueba la herramienta <strong><a href="/advanced-analyzer" style="color: #7BC7C7; text-decoration: none;">Advanced-AI Dream Analyzer</a></strong>.
                </label>
                <p id="analysisResult" class="mt-4" style="text-align: justify;"></p>
                
                <div class="flex justify-center space-x-4 mt-4">
                    <button id="analyzeButton" type="submit" class="relative flex items-center justify-center text-white py-2 px-4 rounded-lg hover:bg-blue-600"
                        style="background-color: rgba(123, 199, 199, var(--tw-bg-opacity));">
                        <span id="buttonText" style="font-weight: 700; font-size: 0.875rem;">Analizar Mi Sueño</span>
                    </button>
                </div>
                <br><br>
            </form>
            
        </Col>
        <Col span="2" />
    </Row>
</Section>
<script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>
<script type="module">
    document.getElementById('dreamForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const analyzeButton = document.getElementById('analyzeButton');
        const buttonText = document.getElementById('buttonText');
        const dreamDescription = document.getElementById('dreamDescription');
        const analysisResult = document.getElementById('analysisResult');
        const comprehensiveAnalysisLabel = document.getElementById('comprehensiveAnalysisLabel');

        if (!analyzeButton || !buttonText || !dreamDescription || !analysisResult || !comprehensiveAnalysisLabel) {
            console.error('Faltan uno o más elementos.');
            return;
        }

        buttonText.textContent = 'Analizando...';
        analyzeButton.disabled = true;

        try {
            const response = await fetch('https://amd-api-anon-limited.vercel.app/analyzer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    lang: 'es',  
                    dream_description: dreamDescription.value 
                }),
            });

            if (response.ok) {
                const result = await response.json();
                analysisResult.textContent = result.analysis;
                buttonText.textContent = 'Intentar de Nuevo';
            } else if (response.status === 429) {
                analysisResult.textContent = 'Has alcanzado el límite de 5 análisis de sueños por día. Por favor, inténtalo de nuevo mañana.';
                buttonText.textContent = 'Límite Alcanzado';
                analyzeButton.disabled = true;
            } else if (response.status === 503) {
                analysisResult.textContent = '¡Demasiados soñadores! Por favor espera un momento e inténtalo de nuevo.';
                buttonText.textContent = 'Analiza Tu Sueño';
            } else {
                const errorData = await response.json();
                analysisResult.textContent = errorData.detail || 'Ocurrió un error inesperado. Por favor, inténtalo de nuevo.';
                buttonText.textContent = 'Analiza Tu Sueño';
            }
        } catch (error) {
            console.error('Error:', error);
            analysisResult.textContent = 'Estamos teniendo problemas para conectar con nuestro servicio de análisis de sueños. Verifica tu conexión a internet e inténtalo de nuevo.';
            buttonText.textContent = 'Analiza Tu Sueño';
        } finally {
            analyzeButton.disabled = false;
            comprehensiveAnalysisLabel.classList.remove('hidden'); 
        }
    });

    function handleClearInput() {
        dreamDescription.value = '';
        analysisResult.textContent = '';
        buttonText.textContent = 'Analiza Tu Sueño';
        comprehensiveAnalysisLabel.classList.add('hidden'); 
        analyzeButton.removeEventListener('click', handleClearInput);
        analyzeButton.addEventListener('click', handleFormSubmit);
    }

    function handleFormSubmit() {
        document.getElementById('dreamForm').dispatchEvent(new Event('submit'));
    }
</script>
