---
// Importações
import Layout from '../layouts/Layout.astro'
import Section from '../components/ui/Section.astro'
import Row from '../components/ui/Row.astro'
import Col from '../components/ui/Col.astro'

const SEO = {
	title: 'AnalyzeMyDream | Explorando significados dos sonhos e aprimorando a compreensão pessoal.',
	description:
		'Uma plataforma abrangente para interpretações e insights de sonhos.'
}
---
<Layout title={SEO.title} description={SEO.description}>
<Section id="analyze-intro" padding="none" classes="bg-neutral-50 dark:bg-neutral-900">
    <Row>
        <Col span="2" />
        <Col span="8" align="center">
            <br><h2 class="text-4xl font-semibold mb-4">Obtenha acesso a uma análise profunda dos sonhos com nossa ferramenta <strong>AI-Advanced Dream Analyzer</strong>.</h2>
            <label for="dreamDescription" class="block text-lg font-medium mb-2">Projetado para revelar as mensagens e insights significativos dentro dos seus sonhos.</label>
            <p class="text-sm text-gray-500 dark:text-gray-300 mb-4">
                Insira uma descrição detalhada do seu sonho e nossa IA gerará uma análise abrangente para você.
            </p><br><br>
        </Col>
        <Col span="2" />
    </Row>
</Section>
<Section id="dream-form" padding="none" classes="bg-neutral-50 dark:bg-neutral-900">
    <Row>
        <Col span="2" />
        <Col span="8" align="center">
            <form id="dreamForm" class="space-y-4">
                <div class="p-4 bg-white dark:bg-neutral-800 shadow-md rounded-lg space-y-4" style="border-radius:20px;">
                    <!-- Tipo de Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Tipo de Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamType" value="Experienciado" /> Experienciado</label>
                            <label class="mr-4"><input type="radio" name="dreamType" value="Lúcido" /> Lúcido</label>
                            <label class="mr-4"><input type="radio" name="dreamType" value="Embaçado" /> Embaçado</label>
                            <label><input type="radio" name="dreamType" value="N/A" /> N/A</label>
                        </div>
                    </div>
    
                    <!-- Importância do Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Importância do Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamImportance" value="Insignificante" /> Insignificante</label>
                            <label class="mr-4"><input type="radio" name="dreamImportance" value="Neutra" /> Neutra</label>
                            <label class="mr-4"><input type="radio" name="dreamImportance" value="Muito Importante" /> Muito Importante</label>
                            <label><input type="radio" name="dreamImportance" value="N/A" /> N/A</label>
                        </div>
                    </div>
    
                    <!-- Emoções Principais -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Emoções Principais</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="checkbox" name="mainEmotions" value="Felicidade" /> Felicidade</label>
                            <label class="mr-4"><input type="checkbox" name="mainEmotions" value="Tristeza" /> Tristeza</label>
                            <label class="mr-4"><input type="checkbox" name="mainEmotions" value="Medo" /> Medo</label>
                            <label class="mr-4"><input type="checkbox" name="mainEmotions" value="Ansiedade" /> Ansiedade</label>
                            <label class="mr-4"><input type="checkbox" name="mainEmotions" value="Raiva" /> Raiva</label>
                            <label><input type="checkbox" name="mainEmotions" value="N/A" /> N/A</label>
                        </div>
                    </div>
    
                    <!-- Contexto do Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Contexto do Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamContext" value="Familiar" /> Familiar</label>
                            <label class="mr-4"><input type="radio" name="dreamContext" value="Desconhecido" /> Desconhecido</label>
                            <label class="mr-4"><input type="radio" name="dreamContext" value="Ambiente Natural" /> Ambiente Natural</label>
                            <label class="mr-4"><input type="radio" name="dreamContext" value="Ambiente Urbano" /> Ambiente Urbano</label>
                            <label><input type="radio" name="dreamContext" value="N/A" /> N/A</label>
                        </div>
                    </div>
    
                    <!-- Estado do Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Estado do Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamState" value="Revigorado" /> Revigorado</label>
                            <label class="mr-4"><input type="radio" name="dreamState" value="Cansado" /> Cansado</label>
                            <label class="mr-4"><input type="radio" name="dreamState" value="Confuso" /> Confuso</label>
                            <label class="mr-4"><input type="radio" name="dreamState" value="Indiferente" /> Indiferente</label>
                            <label><input type="radio" name="dreamState" value="N/A" /> N/A</label>
                        </div>
                    </div>
    
                    <!-- Frequência do Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Frequência do Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamFrequency" value="Raramente" /> Raramente</label>
                            <label class="mr-4"><input type="radio" name="dreamFrequency" value="Ocasionalmente" /> Ocasionalmente</label>
                            <label class="mr-4"><input type="radio" name="dreamFrequency" value="Frequentemente" /> Frequentemente</label>
                            <label class="mr-4"><input type="radio" name="dreamFrequency" value="Sempre" /> Sempre</label>
                            <label><input type="radio" name="dreamFrequency" value="N/A" /> N/A</label>
                        </div>
                    </div>

                    <!-- Expectativas do Sonho -->
                    <div class="card">
                        <h3 class="text-lg font-medium mb-2">Expectativas do Sonho</h3>
                        <div class="flex flex-wrap" style="justify-content:center;">
                            <label class="mr-4"><input type="radio" name="dreamExpectations" value="Resolução de Problemas" /> Resolução de Problemas</label>
                            <label class="mr-4"><input type="radio" name="dreamExpectations" value="Insight Pessoal" /> Insight Pessoal</label>
                            <label class="mr-4"><input type="radio" name="dreamExpectations" value="Alertas" /> Alertas</label>
                            <label class="mr-4"><input type="radio" name="dreamExpectations" value="Sem Expectativa" /> Sem Expectativa</label>
                            <label><input type="radio" name="dreamExpectations" value="N/A" /> N/A</label>
                        </div>
                    </div>
                </div>

               <p class="text-sm text-gray-500 dark:text-gray-300 mb-4">
                    Por favor, use esta ferramenta de forma responsável. Os resultados são destinados apenas para orientação geral. <strong><a href="/faq" style="color: #7BC7C7; text-decoration: none;">Saiba Mais.</a></strong>
                </p>        
                <!-- Entrada do Sonho -->
                <textarea id="dreamDescription" name="dreamDescription" rows="6" cols="50" minlength="30" required class="w-full p-2 border border-gray-300 rounded" placeholder="Insira uma descrição detalhada do seu sonho..."></textarea>

                <p id="analysisResult" class="mt-4" style="text-align: justify;"></p>
                <div class="flex justify-center space-x-4 mt-4">
                    <button id="analyzeButton" type="submit" class="relative flex items-center justify-center text-white py-2 px-4 rounded-lg hover:bg-blue-600" style="background-color: rgba(123, 199, 199, var(--tw-bg-opacity));">
                        <span id="buttonText" style="font-weight: 700; font-size: 0.875rem;">Analisar Meu Sonho</span>
                    </button>
                </div>
                <br>
                </form>
                </Col>
                <Col span="2" />
                </Row>
                </Section>
                </Layout>

<script type="module">
        document.getElementById('dreamForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const analyzeButton = document.getElementById('analyzeButton');
        const buttonText = document.getElementById('buttonText');
        const dreamDescription = document.getElementById('dreamDescription');
        const analysisResult = document.getElementById('analysisResult');
        
        const dreamType = document.querySelector('input[name="dreamType"]:checked')?.value || "N/A";
        const dreamImportance = document.querySelector('input[name="dreamImportance"]:checked')?.value || "N/A";
        const mainEmotions = Array.from(document.querySelectorAll('input[name="mainEmotions"]:checked')).map(el => el.value).join(", ") || "N/A";
        const dreamContext = document.querySelector('input[name="dreamContext"]:checked')?.value || "N/A";
        const dreamState = document.querySelector('input[name="dreamState"]:checked')?.value || "N/A";
        const dreamFrequency = document.querySelector('input[name="dreamFrequency"]:checked')?.value || "N/A";
        const dreamExpectations = document.querySelector('input[name="dreamExpectations"]:checked')?.value || "N/A";

        const additionalInfo = `
            Tipo de Sonho: ${dreamType}
            Importância do Sonho: ${dreamImportance}
            Emoções Principais: ${mainEmotions}
            Contexto do Sonho: ${dreamContext}
            Estado do Sonho: ${dreamState}
            Frequência do Sonho: ${dreamFrequency}
            Expectativas do Sonho: ${dreamExpectations}
        `;

        const fullDescription = `${dreamDescription.value}\n\n${additionalInfo}`;

        if (!analyzeButton || !buttonText || !dreamDescription || !analysisResult) {
            console.error('Um ou mais elementos estão faltando.');
            return;
        }

        buttonText.textContent = 'Analisando...';
        analyzeButton.disabled = true;

        try {
            const response = await fetch('https://br-analyzemydream-gemini.vercel.app/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ dream_description: fullDescription }),
            });

            const result = await response.json();
            if (response.ok) {
                analysisResult.textContent = result.analysis;
                buttonText.textContent = 'Tentar Novamente';
                analyzeButton.removeEventListener('click', handleFormSubmit);
                analyzeButton.addEventListener('click', handleClearInput);
            } else {
                analysisResult.textContent = result.error;
                buttonText.textContent = 'Analisar Meu Sonho';
            }
        } catch (error) {
            analysisResult.textContent = 'Ocorreu um erro. Por favor, tente novamente.';
            buttonText.textContent = 'Analisar Meu Sonho';
        } finally {
            analyzeButton.disabled = false;
        }

        function handleClearInput() {
            dreamDescription.value = '';
            analysisResult.textContent = '';
            buttonText.textContent = 'Analisar Meu Sonho';
            analyzeButton.removeEventListener('click', handleClearInput);
            analyzeButton.addEventListener('click', handleFormSubmit);
        }

        function handleFormSubmit() {
            document.getElementById('dreamForm').dispatchEvent(new Event('submit'));
        }
    });
</script>
